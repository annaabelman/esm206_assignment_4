---
title: "ESM206 Assignment 4"
author: "Anna Abelman and Emma Friedl"
date: "11/7/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, message=FALSE}
#Attaching Packages
library(tidyverse)
library(janitor)
library(here)
library(DT)
library(knitr)
library(kableExtra)

# Read in data
lobster <- read_csv(here("raw_data", "lobster_abundance_sbc_lter.csv"),
                    na = "-99999") %>% 
  clean_names()
```

```{r}
lobster_tidy <- lobster %>% 
  uncount(count)
```


# Introduction:

# Data Methods

# Results:

## A.

Naples and IV are MPA. They were established in 2012
```{r}
lobster_site <- lobster_tidy %>% 
  group_by(year)%>% 
  count(site) %>% 
  mutate(highlight = ifelse(site == "IVEE" | site == "NAPL", "MPA", "Non-MPA"))

  ggplot(data = lobster_site, aes(x = year, y = n, group = site, color = highlight)) +
  geom_line()+
    scale_color_manual(values = c("firebrick3", "dimgray"))+
    scale_size_manual(values = c(1.5,2))+
    theme(legend.position = "none")+
  theme_minimal()+
  labs(x = "Year", y = "Number of Lobsters", title = "Number of Lobsters Per Site, 2012-2018")+
    scale_x_continuous(expand = c(0,0))
  
```

## B.
```{r}
lobster_size <- lobster_tidy %>%
  select(year, site, size_mm) %>% 
  filter(year == c("2012","2018"))

lobster_size$year <- as.factor(lobster_size$year)

 graph <- ggplot(lobster_size, aes(x = site, y = size_mm, fill = year)) +
  geom_violin(position = "dodge", show.legend = FALSE, trim = FALSE)+
    facet_wrap(~site, scales = "free")

graph
  
```


## C.
```{r}
#create a vector containing either "MPA" or "Non_MPA"
#corresponsing to the site
sites = lobster_tidy$site
mpa_sites <- ifelse(sites == "IVEE" | sites == "NAPL", 
                    "MPA", "Non_MPA")

lobster_mean_size <- lobster_tidy %>% 
  mutate(protected_status = mpa_sites) %>% 
  select(year, size_mm, protected_status) %>% 
  filter(year == c("2012","2018")) %>% 
  group_by(protected_status, year) %>% 
  mutate(mean_size = mean(size_mm, na.rm = TRUE)) 

lobster_mean_size$year <- as.factor(lobster_mean_size$year)

ggplot(lobster_mean_size, 
       aes(fill = protected_status, x = year, y = mean_size)) +
  geom_col(position="dodge")

```


```{r}
#mean statistics
lobster_table <- lobster_tidy %>% 
  mutate(protected_status = mpa_sites) %>%
  filter(year == c("2012","2018")) %>% 
  group_by(protected_status, year) %>% 
  summarize(
    mean = mean(size_mm, na.rm = TRUE),
    sd = sd(size_mm, na.rm = TRUE),
    count = n()
  )

kable(lobster_table, col.names = c("Protected Status", "Year", "Mean (mm)", "Standard Deviation (mm)", "Count")) %>% 
  kable_styling(bootstrap_options = "striped", 
                full_width = F,
                position = "left")
  #add_header_above(c("Summary Stats" = 3))
  

#2012 mpa vs non mpa - ttest
lobster_2012_mpa <- lobster_mean_size %>% 
 filter(year == "2012" & protected_status == "MPA") %>% 
  pull(size_mm)

lobster_2012_non <- lobster_mean_size %>% 
  filter(year == "2012" & 
           protected_status == "Non_MPA") %>% 
  pull(size_mm)

mpa_vs_non_2012 <- t.test(lobster_2012_mpa, lobster_2012_non)

#2018 mpa vs non - ttest
lobster_2018_mpa <- lobster_mean_size %>% 
  filter(year == "2018" & protected_status == "MPA") %>% 
  pull(size_mm)

lobster_2018_non <- lobster_mean_size %>% 
  filter(year == "2018", protected_status == "Non_MPA") %>%  pull(size_mm)

mpa_vs_non_2018 <- t.test(lobster_2018_mpa, lobster_2018_non)

#MPA 2012 vs 2018 - ttest
mpa_12_vs_18 <- t.test(lobster_2012_mpa, lobster_2018_mpa)

#Non_MPA 2012 vs 2018 - ttest
non_12_vs_18 <- t.test(lobster_2012_non, lobster_2018_non)

```

In 2012, mean lobster sizes at MPA sites were `r ` % higher than at Non MPA sites (XXXX at MPA, and XXX at Non MPA) 

Mean sizes at MPA (mean +/- Standard Deviation, n = XXX), differed significantly from mean sizes at Non MPA(stats) by a paired two-sample t test(stats)

following dragon reintroduction (Figure 4), compared to those recorded for griffins in the pre-dragon (1984 - 2004) period, and the decrease was statistically significant (one-sample t-test, t(312.2) = 3.8, p = 0.014). Our results reinforce findings from an earlier study by Dumbledore et al. (2013), which reported decreased daily distance traveled and less variation in distance traveled for griffins in the presence of dragons.
# Summary:


# References:

Reed D. 2019. SBC LTER: Reef: Abundance, size and fishing effort for California Spiny Lobster (Panulirus interruptus), ongoing since 2012. Environmental Data Initiative. https://doi.org/10.6073/pasta/a593a675d644fdefb736750b291579a0. Dataset accessed 11/09/2019.










